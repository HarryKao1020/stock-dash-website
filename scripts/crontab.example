# ==============================================================================
# Stock Dashboard 快取更新排程（Parquet 格式）
# ==============================================================================
#
# 安裝方式:
#   1. 複製此檔案: cp scripts/crontab.example /tmp/stock-dash-cron
#   2. 修改路徑為你的專案實際路徑
#   3. 安裝 crontab: crontab /tmp/stock-dash-cron
#   4. 驗證: crontab -l
#
# 移除排程:
#   crontab -r
#
# 說明:
#   - 使用 scripts/update_cache.py 定期更新 Parquet 快取
#   - 取代應用程式內的 auto_refresh 機制
#   - 建議在交易日開盤前執行（7:30）
#
# ==============================================================================

SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin

# 專案路徑 (請修改為你的實際路徑)
PROJECT_DIR=/path/to/stock-dash-project

# Log 目錄
LOG_DIR=$PROJECT_DIR/logs

# ==============================================================================
# 排程設定
# ==============================================================================

# 方法 1: 本地環境 - 每個交易日早上 7:30 更新快取
# 週一到週五 (1-5)
30 7 * * 1-5 cd $PROJECT_DIR && python3 scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# 方法 2: Docker 環境 - 使用 docker-compose exec
# 30 7 * * 1-5 cd $PROJECT_DIR && docker-compose exec -T web python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# 方法 3: Docker 環境 - 使用 docker exec (需要容器名稱)
# 30 7 * * 1-5 docker exec stock-dash-web-1 python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# ==============================================================================
# 可選排程
# ==============================================================================

# 選項 A: 收盤後再更新一次（確保當日資料完整）
# 30 14 * * 1-5 cd $PROJECT_DIR && python3 scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# 選項 B: 每天執行一次（包含週末，為週一準備）
# 30 7 * * * cd $PROJECT_DIR && python3 scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# ==============================================================================
# Cron 語法說明
# ==============================================================================
#
# * * * * *
# │ │ │ │ │
# │ │ │ │ └─── 星期 (0-7, 0 和 7 都是週日)
# │ │ │ └───── 月份 (1-12)
# │ │ └─────── 日期 (1-31)
# │ └───────── 小時 (0-23)
# └─────────── 分鐘 (0-59)
#
# 特殊字元:
# * : 任何時間
# , : 列舉 (例如: 1,3,5)
# - : 範圍 (例如: 1-5)
# / : 間隔 (例如: */4 表示每 4 小時)
#
# ==============================================================================
# Log 管理
# ==============================================================================
#
# 定期清理舊 log（每月 1 號凌晨 2 點）
# 0 2 1 * * find $LOG_DIR -name "*.log" -mtime +30 -delete
#
# ==============================================================================
