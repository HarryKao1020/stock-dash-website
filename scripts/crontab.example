# ==============================================================================
# Stock Dashboard 快取更新排程（Parquet 格式）
# ==============================================================================
#
# 安裝方式:
#   1. 複製此檔案: cp scripts/crontab.example /tmp/stock-dash-cron
#   2. 修改路徑為你的專案實際路徑
#   3. 安裝 crontab: crontab /tmp/stock-dash-cron
#   4. 驗證: crontab -l
#
# 移除排程:
#   crontab -r
#
# 說明:
#   - 使用 scripts/update_cache.py 定期更新 Parquet 快取
#   - 取代應用程式內的 auto_refresh 機制
#   - 建議在交易日開盤前執行（7:30）
#
# ==============================================================================

SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin

# 專案路徑 (請修改為你的實際路徑)
PROJECT_DIR=/path/to/stock-dash-project

# Log 目錄
LOG_DIR=$PROJECT_DIR/logs

# ==============================================================================
# 排程設定 - 多時段更新快取
# ==============================================================================
#
# 建議時段：
#   1. 早上 07:30 - 開盤前更新資料
#   2. 下午 13:45 - 盤中更新（午休後）
#   3. 下午 17:30 - 收盤後更新當日完整資料
#   4. 半夜 00:00 - 深夜更新（確保隔日資料準備完成）
#
# ==============================================================================

# 方法 1: 本地環境（不推薦，Docker 部署請用方法 2 或 3）
# 30 7 * * 1-5 cd $PROJECT_DIR && python3 scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
# 45 13 * * 1-5 cd $PROJECT_DIR && python3 scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
# 30 17 * * 1-5 cd $PROJECT_DIR && python3 scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
# 0 0 * * * cd $PROJECT_DIR && python3 scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# 方法 2: Docker 環境 - 使用 docker-compose exec（推薦）
30 7 * * 1-5 cd $PROJECT_DIR && docker-compose exec -T web python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
45 13 * * 1-5 cd $PROJECT_DIR && docker-compose exec -T web python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
30 17 * * 1-5 cd $PROJECT_DIR && docker-compose exec -T web python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
0 0 * * * cd $PROJECT_DIR && docker-compose exec -T web python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# 方法 3: Docker 環境 - 使用 docker exec（需要確認容器名稱）
# 30 7 * * 1-5 docker exec stock-dash-web-1 python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
# 45 13 * * 1-5 docker exec stock-dash-web-1 python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
# 30 17 * * 1-5 docker exec stock-dash-web-1 python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1
# 0 0 * * * docker exec stock-dash-web-1 python scripts/update_cache.py >> $LOG_DIR/cache_update.log 2>&1

# ==============================================================================
# Cron 語法說明
# ==============================================================================
#
# * * * * *
# │ │ │ │ │
# │ │ │ │ └─── 星期 (0-7, 0 和 7 都是週日)
# │ │ │ └───── 月份 (1-12)
# │ │ └─────── 日期 (1-31)
# │ └───────── 小時 (0-23)
# └─────────── 分鐘 (0-59)
#
# 特殊字元:
# * : 任何時間
# , : 列舉 (例如: 1,3,5)
# - : 範圍 (例如: 1-5)
# / : 間隔 (例如: */4 表示每 4 小時)
#
# ==============================================================================
# Log 管理
# ==============================================================================
#
# 定期清理舊 log（每月 1 號凌晨 2 點）
# 0 2 1 * * find $LOG_DIR -name "*.log" -mtime +30 -delete
#
# ==============================================================================
